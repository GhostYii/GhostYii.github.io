I"ư<hr />
<h2 id="引言">引言</h2>
<p>游戏内的字幕对于玩家而言是一个非常有用的辅助功能，同时对一些特殊群体的玩家来说是一个必不可少的功能。也就是说在游戏内拥有字幕功能是一个非常重要且基础的事情。本文将介绍一个在Unity中借助UGUI与DOTween实现的字幕系统。同时，本文所介绍的字幕系统将在Github开源，点击<a href="https://github.com/GhostYii/SubtitleSystem_Demo" target="_blank">此处</a>查看开源地址。</p>

<hr />
<h2 id="subtitle-system介绍">Subtitle System介绍</h2>
<p>SubtitleSystem是一个便于在游戏内添加字幕以及拓展的Unity开源项目，目前(2020.02.02)已经开发完成第一个版本，其主要功能包括：</p>
<ul>
  <li>创建SubtitleAsset资源以持久化存储字幕</li>
  <li>使用SubtitleAssetEditorWindow以方便查看与编辑字幕文件</li>
  <li>使用SubtitleAssetPlayer以实现字幕的顺序播放</li>
  <li>使用SubtitleManager单例以实现自定义字幕显示</li>
  <li>使用SubtitleSequence以实现自定义字幕序列</li>
  <li>使用Subtitle以拓展字幕显示形式</li>
</ul>

<p>V1.0使用Unity2018.3.0f2创建，在Unity2019.3.0f6上测试运行正常，理论上可运行于DoTween所支持的所有Unity版本上。</p>

<hr />
<h2 id="subtitle-asset资源的设置">Subtitle Asset资源的设置</h2>
<p>如果需要实现对游戏内的过场CG或者视频添加字幕文件，可以通过SubtitleAsset来对字幕进行管理与播放。<strong>SubtitleAsset</strong>是SubtitleSystem内自定义的一个ScriptableObject资源，可以方便的进行保存与修改，同时，该系统编写了一个专门用于编辑SubtitleAsset的编辑器界面可用于查看与编辑字幕。<br />
创建SubtitleAsset的过程与创建其他类型的资源类似，可以通过在<em>Asset窗口右键-Create-Subtitle Asset</em>实现，如下图所示：<br />
<img src="../assets/img/SubtitleSystem/createasset.png" alt="create asset" /><br />
也可以通过Unity顶部的Asset选项卡创建，<em>Asset-Create-Subtitle Asset</em>，如下图所示：<br />
<img src="../assets/img/SubtitleSystem/createasset1.png" alt="create asset by menu" /><br />
创建完成后Unity将生成一个Asset文件，选择该文件将显示该字幕文件的简要信息，
<img src="../assets/img/SubtitleSystem/subtitleinspector.png" alt="brief info" /><br />
在此界面，可以选择“从文件导入”、“导出到文件”、“打开编辑器”三项操作，其中导入导出均对.sa文件进行操作，打开编辑器可以查看本文件的详细字幕内容。编辑器分为四个部分，如下图所示
<img src="../assets/img/SubtitleSystem/asseteditor.png" alt="asset editor" /><br />
其中红色部分代表本字幕文件一些说明信息，包括Version与Info两个字段，黄色部分代表本字幕文件所需要的所有格式信息，蓝色部分代表所有字幕内容。底部功能按钮区可以对本文件进行导入导出操作。值得注意的一点是，<strong>在Formats(黄色区域)内的Font字段所选择的字体，应该全部存放在Resources/Font文件夹下</strong>，否则SubtitleSystem将无法正确寻找到对应的字体而报错。Formats区域所选择的格式操作基本是属于UnityEngine.UI.Text组件的属性。<br />
Subtitles区域则是整个字幕文件的主要区域，其每个字幕item的前两个属性用于选择应用于此条字幕的格式，如果选择FormatIndex，则使用Index寻找格式，格式的Index在格式名称后使用“<strong>[]</strong>”标注，如果选择FormatCode，则会去寻找Formats区域内第一个Code匹配的格式。同一条字幕只能对应一种格式。Position字段标明该条字幕显示在屏幕上的位置，其对应Text组件的rectTransform.localPosition属性。Content标明字幕内容，Duration标明此条字幕的持续时间。<br />
其中Subtitles区域内的导入导出功能仅对此区域有效，导入可选择.txt格式或者该系统定义的.subs格式，导出仅可导出.subs格式，其中.txt格式会将txt文件内的每一行当作一条字幕导入，其余属性将使用默认属性，如果需要自定义属性，可以通过以下格式定义：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"content"|"FormatIndex"|"FormatCode"|"Duration"|"FadeInDuration"|"FadeOutDuration"|"IsVertical"|"(position.x, position.y)"
</code></pre></div></div>
<p>其中每个字段使用两个<strong>“</strong>符号包括，在<strong>“</strong>内部可以继续使用<strong>“</strong>符号不会影响导入，每个字段之间使用<strong>|</strong>符号隔开，其中字段顺序如上所述。如果选择FormatIndex来确定格式，则FormatCode保持为空，反之则FormatIndex保持为-1。<br />
值得注意的是，如果游戏内的格式几乎完全一致，那么可以通过保存一个只存有格式的.sa文件（通过Subtitle Asset Editor的Save to (SA)file功能）与不同的.subs（通过Subtitle Asset Editor内Subtitles区域的Save subtitles to file功能或者按照上述格式手动创建）来动态创建SubtitleAsset，在代码中可以使用以下代码实现。</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SubtitleAsset</span> <span class="nf">CreateAsset</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SubtitleAsset</span> <span class="n">sa</span> <span class="p">=</span> <span class="n">SubtitleAsset</span><span class="p">.</span><span class="n">CreateInstance</span><span class="p">&lt;</span><span class="n">SubtitleAsset</span><span class="p">&gt;();</span>
    <span class="n">sa</span><span class="p">.</span><span class="nf">LoadFromFile</span><span class="p">(</span><span class="s">"format_templete.sa"</span><span class="p">);</span>
    <span class="kt">string</span><span class="p">[]</span> <span class="n">lines</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">.</span><span class="nf">ReadAllLines</span><span class="p">(</span><span class="s">"subtiles.subs"</span><span class="p">);</span>        
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">line</span> <span class="k">in</span> <span class="n">lines</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SubtitleInfo</span> <span class="n">tmp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SubtitleInfo</span><span class="p">();</span>
        <span class="n">tmp</span><span class="p">.</span><span class="nf">InitByFormat</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
        <span class="n">sa</span><span class="p">.</span><span class="n">subtitles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">sa</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<hr />
<h2 id="subtitle-asset-player使用">Subtitle Asset Player使用</h2>
<p>当SubtitleAsset设置完成后，可以使用SubtitleAssetPlayer脚本来实现播放功能，其使用方法非常简单，<strong>首先在场景中任意物体上挂载一个SubtitleManager脚本并且指定一个CanvasPrefab</strong>，这一步是使用SubtitleSystem的必要条件，在本文所介绍的字幕系统中，所有所有播放操作都需要用到SubtitleManager脚本，<strong>故在进行操作前务必先指定SubtitleManager</strong>。之后在场景任意物体上挂载一个SubtitleAssetPlayer脚本即可。<br />
该脚本主要需要指定一个SubtitleAsst资源以实现播放，用户可以指定该Asset播放的Text组件，如果Text未指定则会在运行时创建一个动态的Text。同时在该脚本的Inspector面板存在三个控制按钮，分别是Play、Pause、Stop按钮以方便对SubtitleAsset资源的进度控制。在这三个按钮的下方是简易监视面板，此面板在设置完成后，在运行时可以监视当前播放的字幕信息与进度，具体效果如下图所示：
<img src="../assets/img/SubtitleSystem/assetplayer.gif" alt="subtitle asset player" /></p>

<hr />
<h2 id="subtitle-manager使用">Subtitle Manager使用</h2>
<p>在上文中已经提到SubtitleManager组件是整个字幕系统正确运行的必要条件，该脚本是一个单例脚本，在工程任意位置中可以使用<code class="language-plaintext highlighter-rouge">SubtitleManager.Instance</code>来获取本脚本的实例，该组件中存在一部分控制代码，其中比较重要的一些公共方法如下：</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//创建一个动态Text组件</span>
<span class="k">public</span> <span class="n">Text</span> <span class="nf">CreateText</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fontSize</span><span class="p">,</span> <span class="n">Color</span> <span class="n">color</span><span class="p">,</span> <span class="kt">string</span> <span class="n">fontName</span> <span class="p">=</span> <span class="s">"Arial"</span><span class="p">);</span>

<span class="c1">//显示字幕，duration&lt;=0时该字幕会永久显示</span>
<span class="c1">//Show存在其他8个重载</span>
<span class="k">public</span> <span class="n">Subtitle</span> <span class="nf">Show</span><span class="p">(</span><span class="kt">string</span> <span class="n">content</span><span class="p">,</span> <span class="kt">float</span> <span class="n">duration</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">playOnCreate</span> <span class="p">=</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">//显示竖排字幕，duration&lt;=0时该字幕会永久显示</span>
<span class="c1">//ShowVertical存在其他6个重载</span>
<span class="k">public</span> <span class="n">Subtitle</span> <span class="nf">ShowVertical</span><span class="p">(</span><span class="kt">string</span> <span class="n">content</span><span class="p">,</span> <span class="kt">float</span> <span class="n">duration</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">playOnCreate</span> <span class="p">=</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">//显示淡入淡出字幕</span>
<span class="k">public</span> <span class="n">Subtitle</span> <span class="nf">ShowWithFade</span><span class="p">(</span><span class="kt">string</span> <span class="n">content</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fontSize</span><span class="p">,</span> <span class="n">Color</span> <span class="n">color</span><span class="p">,</span> <span class="kt">float</span> <span class="n">duration</span><span class="p">,</span> <span class="kt">float</span> <span class="n">fadeInDuration</span><span class="p">,</span> <span class="kt">float</span> <span class="n">fadeOutDuration</span><span class="p">,</span> <span class="kt">string</span> <span class="n">fontName</span> <span class="p">=</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">playOnCreate</span> <span class="p">=</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">//显示带震动效果的字幕</span>
<span class="k">public</span> <span class="n">Subtitle</span> <span class="nf">ShowWithShakePosition</span><span class="p">(</span><span class="kt">string</span> <span class="n">content</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fontSize</span><span class="p">,</span> <span class="n">Color</span> <span class="n">color</span><span class="p">,</span> <span class="kt">float</span> <span class="n">duration</span><span class="p">,</span> <span class="kt">float</span> <span class="n">intensity</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">fadeOut</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="kt">string</span> <span class="n">fontName</span> <span class="p">=</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">playOnCreate</span> <span class="p">=</span> <span class="k">true</span><span class="p">);</span>
<span class="k">public</span> <span class="n">Subtitle</span> <span class="nf">ShowWithShakeRotation</span><span class="p">(</span><span class="kt">string</span> <span class="n">content</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fontSize</span><span class="p">,</span> <span class="n">Color</span> <span class="n">color</span><span class="p">,</span> <span class="kt">float</span> <span class="n">duration</span><span class="p">,</span> <span class="kt">float</span> <span class="n">intensity</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">fadeOut</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="kt">string</span> <span class="n">fontName</span> <span class="p">=</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">playOnCreate</span> <span class="p">=</span> <span class="k">true</span><span class="p">);</span>
<span class="k">public</span> <span class="n">Subtitle</span> <span class="nf">ShowWithShakeScale</span><span class="p">(</span><span class="kt">string</span> <span class="n">content</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fontSize</span><span class="p">,</span> <span class="n">Color</span> <span class="n">color</span><span class="p">,</span> <span class="kt">float</span> <span class="n">duration</span><span class="p">,</span> <span class="kt">float</span> <span class="n">intensity</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">fadeOut</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="kt">string</span> <span class="n">fontName</span> <span class="p">=</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">playOnCreate</span> <span class="p">=</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">//显示打字机效果字幕</span>
<span class="k">public</span> <span class="n">Subtitle</span> <span class="nf">ShowWithTypewriter</span><span class="p">(</span><span class="kt">string</span> <span class="n">content</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fontSize</span><span class="p">,</span> <span class="n">Color</span> <span class="n">color</span><span class="p">,</span> <span class="kt">float</span> <span class="n">duration</span><span class="p">,</span> <span class="kt">float</span> <span class="n">interval</span><span class="p">,</span> <span class="kt">string</span> <span class="n">fontName</span> <span class="p">=</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">playOnCreate</span> <span class="p">=</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">//显示自定义效果字幕</span>
<span class="c1">//onPlay(Text text, float duration)</span>
<span class="c1">//onUpdate(Text text, float currentProgress)</span>
<span class="k">public</span> <span class="n">Subtitle</span> <span class="nf">ShowWithCustom</span><span class="p">(</span><span class="kt">string</span> <span class="n">content</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fontSize</span><span class="p">,</span> <span class="n">Color</span> <span class="n">color</span><span class="p">,</span> <span class="kt">float</span> <span class="n">duration</span><span class="p">,</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">Text</span><span class="p">,</span> <span class="kt">float</span><span class="p">&gt;</span> <span class="n">onPlay</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Text</span><span class="p">,</span> <span class="kt">float</span><span class="p">&gt;</span> <span class="n">onUpdate</span><span class="p">,</span> <span class="n">Action</span> <span class="n">onComplete</span><span class="p">,</span> <span class="kt">string</span> <span class="n">fontName</span> <span class="p">=</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">playOnCreate</span> <span class="p">=</span> <span class="k">true</span><span class="p">);</span>
</code></pre></div></div>
<p>其各个效果预览如下：
<img src="../assets/img/SubtitleSystem/subtitledemo.gif" alt="subtitle demo" /></p>

<p>其中<code class="language-plaintext highlighter-rouge">ShowWithCustom</code>方法可以对字幕显示效果进行自定义，通过参数<code class="language-plaintext highlighter-rouge">onShow</code>与<code class="language-plaintext highlighter-rouge">onComplete</code>对字幕显示过程与停止的行为进行自定义以达到自定义效果。如上图中颜色渐变可以通过以下代码实现：</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithCustom</span><span class="p">(</span><span class="s">"自定义效果字幕，字体颜色渐变为红色"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">2f</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">t</span><span class="p">.</span><span class="nf">DOColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">,</span> <span class="m">3f</span><span class="p">));</span>
</code></pre></div></div>

<hr />
<h2 id="subtitle-sequence使用">Subtitle Sequence使用</h2>
<p>除了使用SubtitleAsset资源进行固定序列字幕之外，SubtitleSystem也支持使用代码动态生成序列进行播放，在代码中使用到的类为SubtitleSequence，此序列用法类似于DOTween中的Sequence，其主要API如下：</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//尾部添加</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Append</span><span class="p">(</span><span class="n">Subtitle</span> <span class="n">item</span><span class="p">);</span>
<span class="c1">//尾部添加空白间隔</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">AppendInterval</span><span class="p">(</span><span class="kt">float</span> <span class="n">interval</span><span class="p">);</span>
<span class="c1">//插入字幕</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">Subtitle</span> <span class="n">item</span><span class="p">);</span>
<span class="c1">//插入间隔</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">InsertInterval</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">float</span> <span class="n">interval</span><span class="p">);</span>
<span class="c1">//添加同时播放的字幕</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Join</span><span class="p">(</span><span class="n">Subtitle</span> <span class="n">item</span><span class="p">);</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Join</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">Subtitle</span> <span class="n">item</span><span class="p">);</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">();</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">TogglePause</span><span class="p">();</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Stop</span><span class="p">();</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Restart</span><span class="p">();</span>
</code></pre></div></div>
<p>上一部分中各个字幕的演示效果Sequence代码如下：</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SubtitleSequence</span> <span class="n">sequence</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SubtitleSequence</span><span class="p">();</span>
<span class="n">sequence</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"字幕测试，所有字幕显示时间2s"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="m">2f</span><span class="p">,</span> <span class="k">false</span><span class="p">));</span>
<span class="n">sequence</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowVertical</span><span class="p">(</span><span class="s">"竖排字幕预览"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">2f</span><span class="p">,</span> <span class="k">false</span><span class="p">));</span>
<span class="n">sequence</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithFade</span><span class="p">(</span><span class="s">"淡入淡出字幕，淡入淡出各2s"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">2f</span><span class="p">,</span> <span class="m">2f</span><span class="p">,</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="k">false</span><span class="p">));</span>
<span class="n">sequence</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithShakePosition</span><span class="p">(</span><span class="s">"位置震动字幕"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">2f</span><span class="p">,</span> <span class="m">30f</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="k">false</span><span class="p">));</span>
<span class="n">sequence</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithShakeRotation</span><span class="p">(</span><span class="s">"旋转震动字幕"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">2f</span><span class="p">,</span> <span class="m">90f</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="k">false</span><span class="p">));</span>
<span class="n">sequence</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithShakeScale</span><span class="p">(</span><span class="s">"缩放震动字幕"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">2f</span><span class="p">,</span> <span class="m">5f</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="k">false</span><span class="p">));</span>
<span class="n">sequence</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithTypewriter</span><span class="p">(</span><span class="s">"打字机效果预览字幕"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">2f</span><span class="p">,</span> <span class="m">0.1f</span><span class="p">,</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="k">false</span><span class="p">));</span>
<span class="n">sequence</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithCustom</span><span class="p">(</span><span class="s">"自定义效果字幕，字体颜色渐变为红色"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">2f</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">t</span><span class="p">.</span><span class="nf">DOColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">,</span> <span class="m">2f</span><span class="p">),</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="k">false</span><span class="p">));</span>
<span class="n">sequence</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="k">new</span> <span class="nf">Subtitle</span><span class="p">(</span><span class="s">"常驻字幕，永不消失"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="s">"Arial"</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>    

<span class="n">sequence</span><span class="p">.</span><span class="nf">Play</span><span class="p">();</span>
</code></pre></div></div>
<p>值得注意的一点是使用SubtitleManager.Instance产生的内置效果字幕默认状态下会在创建后立即播放，如果需要加入Sequence统一管理，则需要将最后一个参数设置为false，如果使用的是Subtitle的构造函数则不需要进行设置。</p>

<hr />
<h2 id="暂停功能">暂停功能</h2>
<p>本系统中Subtitle、SubtitleSequence与SubtitleAsset在播放过程中均支持暂停与继续，但是值得注意的一点是，如果用户创建自定义效果（无论是使用SubtitleManager.Instance.ShowWithCustom还是使用Subtitle的onPlay，onUpdate，onComplete回调创建）。<strong>如果需要系统对该效果实现暂停功能，用户需要使得自定义效果Tween均使用DoTween来创建，创建主体为该Subtitle所引用的Text上任意组件</strong>。同时，<strong>使用Unity协程创建的持续效果不会被SubtitleSystem暂停功能所响应</strong>！<br />
如上文中创建的自定义效果，字体颜色渐变为红色中，在onPlay方法使用到了DOColor方法，创建主体为Text，此Text为该Subtitle所引用的Text，故可以实现暂停功能。<br />
值得注意的一点是，在本工程中提供了一个SubtitleUtility工具类，内部有WaitSecondsForSomething方法可实现延时效果，由于该方法内部原理是使用了协程Coroutine，所以使用该方法创建的SubtitleSequence不会被暂停功能所响应，即，上文Sequence可使用以下代码实现类似SubtitleSequence的效果：</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"字幕测试"</span><span class="p">,</span> <span class="m">3f</span><span class="p">);</span>
        <span class="n">SubtitleUtility</span><span class="p">.</span><span class="nf">WaitSecondsForSomething</span><span class="p">(()</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"测试字幕，白色"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">3f</span><span class="p">);</span>
            <span class="n">SubtitleUtility</span><span class="p">.</span><span class="nf">WaitSecondsForSomething</span><span class="p">(()</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithFade</span><span class="p">(</span><span class="s">"淡入测试"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">3f</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
                <span class="n">SubtitleUtility</span><span class="p">.</span><span class="nf">WaitSecondsForSomething</span><span class="p">(()</span> <span class="p">=&gt;</span>
                <span class="p">{</span>
                    <span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithFade</span><span class="p">(</span><span class="s">"淡出测试"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">3f</span><span class="p">);</span>
                    <span class="n">SubtitleUtility</span><span class="p">.</span><span class="nf">WaitSecondsForSomething</span><span class="p">(()</span> <span class="p">=&gt;</span>
                    <span class="p">{</span>
                        <span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithShakePosition</span><span class="p">(</span><span class="s">"位置震动测试"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">3f</span><span class="p">,</span> <span class="m">30f</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                        <span class="n">SubtitleUtility</span><span class="p">.</span><span class="nf">WaitSecondsForSomething</span><span class="p">(()</span> <span class="p">=&gt;</span>
                        <span class="p">{</span>
                            <span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithShakeRotation</span><span class="p">(</span><span class="s">"旋转震动测试"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">3f</span><span class="p">,</span> <span class="m">90f</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                            <span class="n">SubtitleUtility</span><span class="p">.</span><span class="nf">WaitSecondsForSomething</span><span class="p">(()</span> <span class="p">=&gt;</span>
                            <span class="p">{</span>
                                <span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithShakeScale</span><span class="p">(</span><span class="s">"缩放震动测试"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">3f</span><span class="p">,</span> <span class="m">10f</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                                <span class="n">SubtitleUtility</span><span class="p">.</span><span class="nf">WaitSecondsForSomething</span><span class="p">(()</span> <span class="p">=&gt;</span>
                                <span class="p">{</span>
                                    <span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithTypewriter</span><span class="p">(</span><span class="s">"打字机效果预览字幕"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">3f</span><span class="p">,</span> <span class="m">3f</span> <span class="p">/</span> <span class="m">9f</span><span class="p">);</span>
                                    <span class="n">SubtitleUtility</span><span class="p">.</span><span class="nf">WaitSecondsForSomething</span><span class="p">(()</span> <span class="p">=&gt;</span>
                                    <span class="p">{</span>
                                        <span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowWithCustom</span><span class="p">(</span><span class="s">"自定义效果字幕，变成红色"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">3f</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">t</span><span class="p">.</span><span class="nf">DOColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">,</span> <span class="m">3f</span><span class="p">),</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                                        <span class="n">SubtitleUtility</span><span class="p">.</span><span class="nf">WaitSecondsForSomething</span><span class="p">(()</span> <span class="p">=&gt;</span>
                                        <span class="p">{</span>
                                            <span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ShowVertical</span><span class="p">(</span><span class="s">"竖排字幕测试"</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span> <span class="m">3f</span><span class="p">);</span>
                                            <span class="n">SubtitleUtility</span><span class="p">.</span><span class="nf">WaitSecondsForSomething</span><span class="p">(()</span> <span class="p">=&gt;</span>
                                            <span class="p">{</span>
                                                <span class="n">SubtitleManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"常驻字幕"</span><span class="p">);</span>
                                            <span class="p">},</span> <span class="m">3f</span><span class="p">);</span>
                                        <span class="p">},</span> <span class="m">3f</span><span class="p">);</span>
                                    <span class="p">},</span> <span class="m">6f</span><span class="p">);</span>
                                <span class="p">},</span> <span class="m">3f</span><span class="p">);</span>
                            <span class="p">},</span> <span class="m">3f</span><span class="p">);</span>
                        <span class="p">},</span> <span class="m">3f</span><span class="p">);</span>
                    <span class="p">},</span> <span class="m">3f</span><span class="p">);</span>
                <span class="p">},</span> <span class="m">3f</span><span class="p">);</span>
            <span class="p">},</span> <span class="m">3f</span><span class="p">);</span>
        <span class="p">},</span> <span class="m">3f</span><span class="p">);</span>
</code></pre></div></div>
<p>但是上文代码所产生的效果并不能被SubtitleSystem的暂停功能所响应，即使将上文所有Subtitle均加入一个新创建的SubtitleSequence中。</p>

<hr />
<h2 id="其他api">其他API</h2>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SubtitleUtility</span><span class="p">.</span><span class="n">cs</span>
<span class="p">---</span>
<span class="c1">//等待duration时间后执行action</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">WaitSecondsForSomething</span><span class="p">(</span><span class="n">Action</span> <span class="n">action</span><span class="p">,</span> <span class="kt">float</span> <span class="n">duration</span><span class="p">);</span>
<span class="c1">//获取字体</span>
<span class="k">public</span> <span class="k">static</span> <span class="n">Font</span> <span class="nf">GetFontByFontName</span><span class="p">(</span><span class="kt">string</span> <span class="n">fontName</span><span class="p">);</span>
<span class="c1">//在非Mono脚本中执行协程</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">StartCoroutine</span><span class="p">(</span><span class="n">IEnumerator</span> <span class="n">routine</span><span class="p">);</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">StartCoroutine</span><span class="p">(</span><span class="n">IEnumerator</span> <span class="n">routine</span><span class="p">,</span> <span class="kt">string</span> <span class="n">routineTag</span><span class="p">);</span>
<span class="c1">//终止某tag上的所有协程</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">StopAllCoroutines</span><span class="p">(</span><span class="kt">string</span> <span class="n">coroutineTag</span><span class="p">);</span>
</code></pre></div></div>

<hr />
<h2 id="特别感谢">特别感谢</h2>
<p>本系统开发过程中使用了以下开源/免费项目：</p>
<ol>
  <li><a href="http://dotween.demigiant.com/" target="_blank">DOTween</a></li>
  <li><a href="https://github.com/aaubry/YamlDotNet" target="_blank">YamlDotNet</a></li>
</ol>

<hr />
<h2 id="下载">下载</h2>
<ol>
  <li><a href="../assets/downloadable/SubtitleSystem_v1.0f2.unitypackage">SubtitleSystem_V1.0f2 with DOTween_v1.1.575 (Unity2019.3.0f6).unitypackage</a></li>
  <li><a href="../assets/downloadable/SubtitleSystem_v1.0f1.unitypackage">SubtitleSystem_V1.0f1 with DOTween_v1.1.575 (Unity2019.3.0f6).unitypackage</a></li>
</ol>
:ET